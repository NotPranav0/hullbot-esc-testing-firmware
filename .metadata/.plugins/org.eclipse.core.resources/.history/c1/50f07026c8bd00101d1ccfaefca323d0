#ifndef LCD_H
#define LCD_H


#include "stm32l4xx_hal.h"

#define NHD_STARTUP_DELAY 500
#define NHD_I2C_TIMEOUT   10
#define I2C_ADDR 28


/**
 * @brief  NHD LCD I2C Handle Structure
 *
 * This structure holds the configuration for the LCD driver.
 * It must be initialized by the user and passed to all driver functions.
 */
typedef struct
{
    I2C_HandleTypeDef* hi2c;             // Pointer to the HAL I2C handle (e.g., &hi2c1)
    uint8_t             slave_addr_7bit;  // The 7-bit I2C slave address (e.g., 0x28)

} NHD_LCD_I2C_HandleTypedef;


/* Public Functions ----------------------------------------------------------*/

/**
 * @brief Initialize the LCD display.
 * @note  The I2C peripheral (e.g., I2C1) MUST be initialized by the user
 * (e.g., via MX_I2C1_Init()) BEFORE calling this function.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param hi2c Pointer to the initialized HAL I2C_HandleTypeDef.
 * @param slave_addr_7bit The 7-bit I2C slave address of the display.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_Init(NHD_LCD_I2C_HandleTypedef* h_lcd, I2C_HandleTypeDef* hi2c, uint8_t slave_addr_7bit);

/**
 * @brief Write a single data byte to the display (e.g., a character).
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param data The byte of data to write.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_Write(NHD_LCD_I2C_HandleTypedef* h_lcd, uint8_t data);

/**
 * @brief Write a null-terminated string to the display.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param str Pointer to the character string.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_WriteString(NHD_LCD_I2C_HandleTypedef* h_lcd, char* str);

/**
 * @brief Send the command prefix byte (0xFE).
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_Prefix(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Turn the display ON.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_DisplayON(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Turn the display OFF.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_DisplayOFF(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Set the display cursor position via DDRAM address.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param position Desired DDRAM address.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_SetCursor(NHD_LCD_I2C_HandleTypedef* h_lcd, uint8_t position);

/**
 * @brief Move the cursor to line 1, column 1.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_Home(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Clear the display screen.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_ClearScreen(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Set the display's contrast.
 * @note  0x00 <= contrast <= 0x32 (50). Default: 0x28 (40).
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param contrast Desired contrast setting.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_SetContrast(NHD_LCD_I2C_HandleTypedef* h_lcd, uint8_t contrast);

/**
 * @brief Set the display's brightness.
 * @note  0x01 (OFF) <= brightness <= 0x08 (100%).
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param brightness Desired brightness setting.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_SetBrightness(NHD_LCD_I2C_HandleTypedef* h_lcd, uint8_t brightness);

/**
 * @brief Turn the underline cursor ON.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_UnderlineCursorON(NHD_LCD_I2C_HandleTypedef* h_lcd);

#endif /* LCD_H */
