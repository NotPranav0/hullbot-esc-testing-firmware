/**
 ******************************************************************************
 * @file    nhd_serial_lcd_i2c.h
 * @author  Gemini AI (based on Newhaven Display Arduino code)
 * @brief   Header file for NHD Serial LCD I2C driver for STM32 HAL.
 *
 * This driver is adapted from the Newhaven Display Arduino sample code
 * (Serial_LCD.ino) and targets the I2C interface using STM32 HAL functions.
 *
 * (c)2022 Newhaven Display International, LLC.
 * (c)2024 Gemini AI Adaptation
 ******************************************************************************
 */

#ifndef NHD_SERIAL_LCD_I2C_H_
#define NHD_SERIAL_LCD_I2C_H_

/* Includes ------------------------------------------------------------------*/
// Include the main HAL driver for your specific STM32 series
// (e.g., stm32f4xx_hal.h, stm32l4xx_hal.h).
// "main.h" is typically generated by CubeMX and includes the correct HAL definitions.
#include "main.h"

/* Defines -------------------------------------------------------------------*/
#define NHD_STARTUP_DELAY 500  // ms
#define NHD_I2C_TIMEOUT   100    // ms

/* Typedefs ------------------------------------------------------------------*/

/**
 * @brief  NHD LCD I2C Handle Structure
 *
 * This structure holds the configuration for the LCD driver.
 * It must be initialized by the user and passed to all driver functions.
 */
typedef struct
{
    I2C_HandleTypeDef* hi2c;             // Pointer to the HAL I2C handle (e.g., &hi2c1)
    uint8_t             slave_addr_7bit;  // The 7-bit I2C slave address (e.g., 0x28)

} NHD_LCD_I2C_HandleTypedef;


/* Public Functions ----------------------------------------------------------*/

/**
 * @brief Initialize the LCD display.
 * @note  The I2C peripheral (e.g., I2C1) MUST be initialized by the user
 * (e.g., via MX_I2C1_Init()) BEFORE calling this function.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param hi2c Pointer to the initialized HAL I2C_HandleTypeDef.
 * @param slave_addr_7bit The 7-bit I2C slave address of the display.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_Init(NHD_LCD_I2C_HandleTypedef* h_lcd, I2C_HandleTypeDef* hi2c, uint8_t slave_addr_7bit);

/**
 * @brief Write a single data byte to the display (e.g., a character).
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param data The byte of data to write.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_Write(NHD_LCD_I2C_HandleTypedef* h_lcd, uint8_t data);

/**
 * @brief Write a null-terminated string to the display.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param str Pointer to the character string.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_WriteString(NHD_LCD_I2C_HandleTypedef* h_lcd, char* str);

/**
 * @brief Send the command prefix byte (0xFE).
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_Prefix(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Turn the display ON.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_DisplayON(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Turn the display OFF.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_DisplayOFF(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Set the display cursor position via DDRAM address.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param position Desired DDRAM address.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_SetCursor(NHD_LCD_I2C_HandleTypedef* h_lcd, uint8_t position);

/**
 * @brief Move the cursor to line 1, column 1.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_Home(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Clear the display screen.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_ClearScreen(NHD_LCD_I2C_HandleTypedef* h_lcd);

/**
 * @brief Set the display's contrast.
 * @note  0x00 <= contrast <= 0x32 (50). Default: 0x28 (40).
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param contrast Desired contrast setting.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_SetContrast(NHD_LCD_I2C_HandleTypedef* h_lcd, uint8_t contrast);

/**
 * @brief Set the display's brightness.
 * @note  0x01 (OFF) <= brightness <= 0x08 (100%).
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @param brightness Desired brightness setting.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_SetBrightness(NHD_LCD_I2C_HandleTypedef* h_lcd, uint8_t brightness);

/**
 * @brief Turn the underline cursor ON.
 *
 * @param h_lcd Pointer to the NHD_LCD_I2C_HandleTypedef structure.
 * @return HAL_StatusTypeDef HAL_OK on success, HAL_ERROR on failure.
 */
HAL_StatusTypeDef NHD_LCD_UnderlineCursorON(NHD_LCD_I2C_HandleTypedef* h_lcd);

#endif /* NHD_SERIAL_LCD_I2C_H_ */
